<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORACLE - Eternal Garden</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            background: #101010;
            color: #00ff99;
            font-family: 'Fira Mono', 'Consolas', 'Menlo', monospace;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        .oracle-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
            margin: 0;
            border: none;
            background: #181818;
        }
        .oracle-title {
            text-align: center;
            font-size: 2.5em;
            letter-spacing: 2px;
            margin: 32px 0 18px 0;
            color: #00ff99;
        }
        .oracle-chat {
            flex: 1;
            overflow-y: auto;
            padding: 32px 5vw 0 5vw;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .oracle-line {
            font-size: 1.1em;
            white-space: pre-wrap;
            font-family: inherit;
            line-height: 1.5;
        }
        .oracle-line.user {
            color: #00bfff;
        }
        .oracle-line.bot {
            color: #00ff99;
        }
        .oracle-line.system {
            color: #ff6b6b;
        }
        .oracle-input-form {
            display: flex;
            border-top: 1px solid #222;
            background: #101010;
            padding: 18px 5vw;
        }
        .oracle-input {
            flex: 1;
            background: #181818;
            color: #00ff99;
            border: none;
            font-size: 1.3em;
            font-family: inherit;
            padding: 12px;
            outline: none;
        }
        .oracle-send {
            background: #00ff99;
            color: #101010;
            border: none;
            font-size: 1.3em;
            padding: 12px 28px;
            margin-left: 12px;
            cursor: pointer;
            font-family: inherit;
            border-radius: 2px;
            transition: background 0.2s;
        }
        .oracle-send:hover {
            background: #00bfff;
            color: #fff;
        }
        .oracle-send:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }
        .question-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
        }
        .option-btn {
            background: rgba(0, 255, 153, 0.1);
            border: 1px solid #00ff99;
            color: #00ff99;
            padding: 8px 16px;
            font-size: 1em;
            font-family: inherit;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }
        .option-btn:hover {
            background: rgba(0, 255, 153, 0.2);
        }
        .option-btn.selected {
            background: #00ff99;
            color: #101010;
        }
        .result-highlight {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        /* Ensure hamburger menu is visible */
        .hamburger-menu {
            position: fixed !important;
            top: 20px !important;
            right: 20px !important;
            z-index: 9999 !important;
        }
        
        .hamburger-icon {
            z-index: 10000 !important;
        }
        
        .hamburger-icon span {
            background: #fff !important;
        }
    </style>
</head>
<body>
    <div class="hamburger-menu">
        <div class="hamburger-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <nav class="menu-items">
            <ul>
                <li><a href="index.html">HOME</a></li>
                <li>
                    STORY
                    <ul class="sub-menu">
                        <li><a href="codex.html">CODEX</a></li>
                        <li><a href="kindred.html">KINDRED</a></li>
                    </ul>
                </li>
                <li>
                    <a href="projects.html">PROJECTS</a>
                    <ul class="sub-menu">
                        <li><a href="rebirth.html">REBIRTH</a></li>
                        <li><a href="darkside.html">DARKSIDE</a></li>
                    </ul>
                </li>
                <li><a href="soundtrack.html">SOUNDTRACK</a></li>
                <li><a href="soundtrack.html" class="zero-soundtrack">ZERO SOUNDTRACK</a></li>
                <li><a href="darkside-soundtrack.html">DARKSIDE SOUNDTRACK</a></li>
                <li><a href="about.html">ABOUT</a></li>
                <li><a href="oracle.html">ORACLE</a></li>
            </ul>
        </nav>    </div>

    <div class="oracle-container">
        <div class="oracle-title">ORACLE TERMINAL</div>
        <div class="oracle-chat" id="oracleChat"></div>
        <form class="oracle-input-form" id="oracleForm">
            <input class="oracle-input" id="oracleInput" type="text" placeholder="Type your question..." autocomplete="off" required />
            <button class="oracle-send" type="submit">SEND</button>
        </form>
    </div>
    
    <script src="script.js"></script>
    <script>
        const chatEl = document.getElementById('oracleChat');
        const formEl = document.getElementById('oracleForm');
        const inputEl = document.getElementById('oracleInput');
        const sendBtn = document.querySelector('.oracle-send');
        
        let conversation = [];
        let currentMode = 'chat'; // 'chat' or 'assessment'
        let assessmentStep = 0;
        let userAnswers = {};
        let decisiveAnswer = null;

        // LifeCorp Assessment Data
        const assessmentData = {
            intro: `We assume you did your homework, but in case you haven't here's a short story. 
Nexus is our solar system, our home. A brilliant cosm and collection of planets that operate in a harmony of coexistence. We pride ourselves on our advanced existence, our integration with nature and our never-ending push for excellence and evolution.

In order to maintain the balance, we at Lifecorp have been carefully selected to safeguard the Nexus equilibrium preserving the flow of energy, monitoring planetary integrity, and ensuring no single race or world tips the system into chaos.

Now, it's time to select your next life affiliations. You will be asked a series of questions, and pending your answers, a NEXUS planet and race will be selected for you as you are reborn into your next life. Choose Wisely.

Type "BEGIN ASSESSMENT" to start your evaluation.`,
            questions: [
                {
                    id: 1,
                    text: "Identity confirmed. Let's reconstruct your past. What legacy do you inherit?\n\n1. Noble Lineage – You come from a line of distinguished figures. Privilege or burden?\n2. Rebel Lineage – Your ancestors defied the system. You fight for something greater.\n3. Forgotten Past – The records are unclear. Your past is… missing.\n4. Self-Made Legacy – No past defines you. Only your actions matter.\n\nEnter your choice (1-4):",
                    options: ["1", "2", "3", "4"]
                },
                {
                    id: 2,
                    decisive: true,
                    text: "Your physical vessel must be prepared. Which genetic enhancement best suits your capabilities?\n\n1. Fire-wielder with unmatched resilience\n2. Fluid, intuitive being who thrive in the unknown\n3. Nature-bound strategist with an affinity for growth\n4. A guardian of structure, a fortifer of creation and builder of cities\n5. A channeler of light and translator of natural resources\n6. An architect of expansion, one who paints with metal and designs with ease\n\nEnter your choice (1-6):",
                    options: ["1", "2", "3", "4", "5", "6"]
                },
                {
                    id: 3,
                    text: "Even the strongest minds are shaped by their fears. What lingers within you?\n\n1. The Truth – Some knowledge is meant to stay buried.\n2. The Past – What you've done will always find you.\n3. Failure – You will never be enough.\n4. Betrayal – Even those closest to you cannot be trusted.\n5. My Own Power – You are more dangerous than you realize.\n6. Eternal Life – What if you never escape?\n\nEnter your choice (1-6):",
                    options: ["1", "2", "3", "4", "5", "6"]
                }
            ],
            results: {
                0: {
                    race: "KINDRED",
                    planet: "Planet Phoenix",
                    description: `You have been selected for the KINDRED race. You will live a life on Planet Phoenix. Kindred are masters of pyrokinetics, driven by the pursuit of rebirth and transformation. Your purpose is to harness the power of healing and REGENERATION to bring hope to your world and beyond. Kindred's way of life IS deeply rooted in acting for the benefit of the collective. However, there's a stark duality to your nature; if pushed in the wrong direction, you ARE CAPABLE OF TURNING your FOES TO ASHES.`
                },
                1: {
                    race: "AQUATIC",
                    planet: "Planet IRIS",
                    description: `You have been selected for the AQUATIC race. You will live a life on Planet IRIS. Aquatics are connected to the ocean's depths and are dedicated to preserving and understanding marine ecosystems. You will be a guardian of the oceans. You strive to maintain harmony within underwater environments. Intuitive connection with oceanic creatures enables you to communicate and cooperate with the diverse aquatic worlds of your home planet.`
                },
                2: {
                    race: "VERDANT",
                    planet: "Planet Wisdom",
                    description: `You have been selected for the VERDANT race. You will live a life on the Planet Wisdom. Verdants are driven by a deep connection to the natural world and a profound sense of responsibility for its preservation. Your purpose lies in harmonizing with the environment, nurturing its growth, and safeguarding its delicate balance. Your motivations are rooted in a desire to RESTORE and protect ecosystems, seeking to heal the scars left by environmental degradation.`
                },
                3: {
                    race: "LITHIAN",
                    planet: "Planet X",
                    description: `You have been selected for the LITHIAN race. You will live a life on the Planet X. LITHIANS are entrusted with the solemn duty of reshaping and fortifying landscapeS. You possess unparalleled control over earth and minerals, allowing you to shape, reinforce, and manipulate your environment with precision. You wield your geokinetic abilities to reinforce colossal fortifications that span the horizon. Dsciplined and vigilant, LITHIANS ARE committed to upholding their duties as guardians of order.`
                },
                4: {
                    race: "SOLARIS",
                    planet: "Planet Asteria",
                    description: `You have been selected for the SOLARIS race. You will live a life on the Planet Asteria. Solaris are intimately connected to THE celestial. Your body has evolved to harness and channel solar energy, allowing you to absorb sunlight and convert it into vital life force. This unique ability not only grants you increased stamina and vitality during daylight hours but also enhances your overall well-being.`
                },
                5: {
                    race: "CHROMATIC",
                    planet: "Planet Prism",
                    description: `You have been selected for the CHROMATIC race. You will live a life on the Planet Prism. Chromatics possess an innate affinity for architectural innovation and the manipulation of metals. Your existence is centered around your unique ability to shape and interact with the physical world, particularly metals and alloys. This extraordinary gift has led you to become a master architect, engineer and creator of awe-inspiring structures that seamlessly blend technology and aesthetics.`
                }
            }
        };

        function appendLine(text, sender) {
            const line = document.createElement('div');
            line.className = 'oracle-line ' + sender;
            chatEl.appendChild(line);
            if (sender === 'bot') {
                typeWriter(line, text);
            } else {
                line.textContent = text;
            }
            chatEl.scrollTop = chatEl.scrollHeight;
        }

        function typeWriter(element, text, i = 0) {
            if (i < text.length) {
                element.textContent += text.charAt(i);
                setTimeout(() => typeWriter(element, text, i + 1), 18);
            }
        }

        function startAssessment() {
            console.log('startAssessment called');
            currentMode = 'assessment';
            assessmentStep = 0;
            userAnswers = {};
            decisiveAnswer = null;
            
            console.log('About to append intro:', assessmentData.intro);
            appendLine(assessmentData.intro, 'system');
            inputEl.placeholder = "Type 'BEGIN ASSESSMENT' to start...";
        }

        function handleAssessmentInput(userInput) {
            console.log('handleAssessmentInput called with:', userInput, 'step:', assessmentStep);
            if (assessmentStep === 0) {
                if (userInput.toLowerCase().includes('begin assessment')) {
                    assessmentStep = 1;
                    setTimeout(() => {
                        appendLine(assessmentData.questions[0].text, 'bot');
                        inputEl.placeholder = "Enter your choice (1-4)...";
                    }, 1000);
                } else {
                    appendLine("Please type 'BEGIN ASSESSMENT' to start your evaluation.", 'system');
                }
                return;
            }

            const currentQuestion = assessmentData.questions[assessmentStep - 1];
            const validOptions = currentQuestion.options;
            
            if (validOptions.includes(userInput)) {
                const answerIndex = parseInt(userInput) - 1;
                userAnswers[currentQuestion.id] = answerIndex;
                
                if (currentQuestion.decisive) {
                    decisiveAnswer = answerIndex;
                }
                
                assessmentStep++;
                
                if (assessmentStep <= assessmentData.questions.length) {
                    setTimeout(() => {
                        appendLine(assessmentData.questions[assessmentStep - 1].text, 'bot');
                        const nextOptions = assessmentData.questions[assessmentStep - 1].options;
                        inputEl.placeholder = `Enter your choice (1-${nextOptions.length})...`;
                    }, 1000);
                } else {
                    showAssessmentResults();
                }
            } else {
                appendLine(`Invalid input. Please enter a number between 1 and ${validOptions.length}.`, 'system');
            }
        }

        function showAssessmentResults() {
            const result = assessmentData.results[decisiveAnswer];
            const resultText = `ASSESSMENT COMPLETE

Your path is set. LifeCorp has granted you a second chance. Use it wisely.

${result.description}

Type "RESTART" to take the assessment again, or ask me anything else about the Eternal Garden universe.`;
            
            setTimeout(() => {
                appendLine(resultText, 'system');
                currentMode = 'chat';
                inputEl.placeholder = "Ask me anything...";
            }, 1000);
        }

        formEl.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userText = inputEl.value.trim();
            if (!userText) return;
            
            console.log('Form submitted with text:', userText, 'currentMode:', currentMode);
            
            appendLine(userText, 'user');
            inputEl.value = '';
            
            if (currentMode === 'assessment') {
                handleAssessmentInput(userText);
            } else {
                // Handle regular chat
                if (userText.toLowerCase().includes('assessment') || userText.toLowerCase().includes('lifecorp')) {
                    console.log('Assessment trigger detected, calling startAssessment');
                    startAssessment();
                } else if (userText.toLowerCase().includes('restart')) {
                    console.log('Restart trigger detected, calling startAssessment');
                    startAssessment();
                } else {
                    conversation.push({ role: 'user', content: userText });
                    try {
                        const res = await fetch('/api/oracle', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ conversation })
                        });
                        const data = await res.json();
                        if (data && data.reply) {
                            appendLine(data.reply, 'bot');
                            conversation.push({ role: 'assistant', content: data.reply });
                        } else {
                            appendLine('I am the Oracle of the Eternal Garden. Ask me about the universe, the races, the planets, or type "assessment" to begin your LifeCorp evaluation.', 'bot');
                        }
                    } catch (err) {
                        appendLine('I am the Oracle of the Eternal Garden. Ask me about the universe, the races, the planets, or type "assessment" to begin your LifeCorp evaluation.', 'bot');
                    }
                }
            }
        });

        // Initialize with welcome message
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                appendLine('Welcome, Subject to Lifecorp. Your prior existence has ended. You have been selected for the Nexus Reincarnation Program. Your soul signature has been retrieved and processed. Before your next cycle begins, we must assess your essence.\n\nType "assessment" to begin your LifeCorp evaluation.', 'bot');
            }, 500);
        });
    </script>
</body>
</html>
